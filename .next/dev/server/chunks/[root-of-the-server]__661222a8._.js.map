{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///tmp/reembolso-system/app/api/reembolsos/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    \n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '25');\n    const skip = (page - 1) * limit;\n    \n    const search = searchParams.get('search');\n    const ano = searchParams.get('ano');\n    \n    const where: any = {};\n    \n    if (search) {\n      where.OR = [\n        { processo: { contains: search, mode: 'insensitive' } },\n        { beneficiario: { contains: search, mode: 'insensitive' } },\n        { requerente: { contains: search, mode: 'insensitive' } },\n        { cpfTitular: { contains: search, mode: 'insensitive' } },\n        { cpfTitularLimpo: { contains: search, mode: 'insensitive' } },\n        { upm: { contains: search, mode: 'insensitive' } },\n        { especialidade: { contains: search, mode: 'insensitive' } },\n        { decisao: { contains: search, mode: 'insensitive' } },\n        { resultado: { contains: search, mode: 'insensitive' } },\n        { ob: { contains: search, mode: 'insensitive' } },\n      ];\n    }\n    \n    if (ano) {\n      where.anoReferencia = parseInt(ano);\n    }\n    \n    const [registros, total] = await Promise.all([\n      prisma.reembolso.findMany({\n        where,\n        skip,\n        take: limit,\n        orderBy: { data: 'desc' },\n      }),\n      prisma.reembolso.count({ where }),\n    ]);\n    \n    const somaResult = await prisma.reembolso.aggregate({\n      where,\n      _sum: { solicitado: true },\n    });\n    \n    const totalPages = Math.ceil(total / limit);\n    \n    return NextResponse.json({\n      registros,\n      paginacao: {\n        page,\n        limit,\n        total,\n        totalPages,\n      },\n      soma: somaResult._sum.solicitado || 0,\n    });\n  } catch (error) {\n    console.error('Erro ao listar:', error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Erro ao listar' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    \n    const data = body.data ? new Date(body.data) : null;\n    const anoReferencia = data ? data.getFullYear() : null;\n    \n    const cpfTitularLimpo = body.cpfTitular\n      ? body.cpfTitular.replace(/\\D/g, '') || null\n      : null;\n    \n    const reembolso = await prisma.reembolso.create({\n      data: {\n        atribuido: body.atribuido || null,\n        data,\n        anoReferencia,\n        processo: body.processo || null,\n        upm: body.upm || null,\n        beneficiario: body.beneficiario || null,\n        requerente: body.requerente || null,\n        solicitado: body.solicitado ? parseFloat(body.solicitado) : null,\n        cpfTitular: body.cpfTitular || null,\n        cpfTitularLimpo,\n        distribuicao: body.distribuicao ? new Date(body.distribuicao) : null,\n        conformidade: body.conformidade ? new Date(body.conformidade) : null,\n        peg: body.peg || null,\n        especialidade: body.especialidade || null,\n        decisao: body.decisao || null,\n        resultado: body.resultado || null,\n        pagamento: body.pagamento ? new Date(body.pagamento) : null,\n        ob: body.ob || null,\n      },\n    });\n    \n    return NextResponse.json(reembolso, { status: 201 });\n  } catch (error) {\n    console.error('Erro ao criar:', error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Erro ao criar' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}